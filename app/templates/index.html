<html>

<script type=text/javascript src="{{ url_for('static', filename='lib/jquery-3.2.0.min.js') }}"></script>
<script type=text/javascript src="{{ url_for('static', filename='lib/socket.io.min.js') }}"></script>

<script type=text/javascript>
	$(document).ready(function() {
		// Connect to the SocketIO server
		var socket = io.connect();
		var game_id;

		// When connection is made to the server
		socket.on('connect', function() {
			// Prompt user for existing game code, if none provided, create a new game
			game_id = prompt("Enter a game code to join or create a new game with that code.\nLeave blank or press cancel to create a new game.");

			// Send game_id if entered, otherwise send empty string
			if(game_id != null) {
				socket.emit('join', {game_id: game_id});
			} else {
				socket.emit('join', {game_id: ''});
			}
		});

		// Confirm to player that they have joined a game
		socket.on('new_game', function(msg) {
			game_id = msg.game_id;
			$('#log').html('<p>You have joined game <b>' + game_id + '</b></p>');
		});

		// Event handler for game updates
		socket.on('update', function(msg) {
			// Check if property exists in message to allow
			// updating of only some fields at a time
			if(msg.hasOwnProperty('hands')) {
				// Temporary until I get users set up & stop sending all hands to all players
				$('#top_hand').html(msg.hands[1]);

				$('#bottom_hand').html(msg.hands[0]);
			}

			if(msg.hasOwnProperty('top_name')) {
				$('#top_name').html(msg.top_name);
			}

			if(msg.hasOwnProperty('middle')) {
				$('#middle').html(msg.middle);
			}

			if(msg.hasOwnProperty('bottom_name')) {
				$('#bottom_name').html(msg.bottom_name);
			}

			if(msg.hasOwnProperty('bottom')) {
				$('#bottom').html(msg.bottom);
			}

			if(msg.hasOwnProperty('log')) {
				$('#log').html(msg.log);
			}
		});

		// Handle deal button
		$('#bottom').on('click', '#deal', function() {
			socket.emit('deal', {game_id: game_id});
			return false;
		});

		// Handle bidding buttons
		$('#middle').on('click', '.bid_button', function() {
			socket.emit('bid', {game_id: game_id, data: $(this).val()});
			return false;
		});

		// Handle playing a card
		$('#bottom_hand').on('click', '.clickable', function() {
			socket.emit('play_card', {game_id: game_id, data: $(this).val()});
			return false;
		});
	});
</script>

<head>
	<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
	<link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto+Condensed'>
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">

	<title>pb - Pitch Bot</title>
</head>

<body>
	<div class="hand" id="top_hand"></div>

	<div class="name" id="top_name"><p><b>Player 2</b></p></div>

	<div id="log"></div>

	<div class="hand" id="middle"></div>

	<div class="name" id="bottom_name"><p><b>Player 1</b></p></div>

	<div class="hand" id="bottom_hand"></div>

	<div id="bottom">
		<button id="deal" type="button">Deal</button>
	</div>

</body>
</html>
